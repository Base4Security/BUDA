{% extends "base.html" %}

{% block title %}Activity Management{% endblock %}

{% block content %}
<h3 class="mb-4">Activity Management</h3>

<!-- Formulario para crear una actividad -->
<div class="card mb-4">
    <div class="card-header">Activities</div>
    <div class="card-body">
        {% if activities %}
        <ul class="list-group">
            {% for activity in activities %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ activity.description }}</strong> - {{ activity.details }} (Perfil: {{ activity.user_profile.name }})
                </div>
                <div>
                    <a href="{{ url_for('activities_bp.edit_activity', activity_id=activity.id) }}" class="btn btn-warning btn-sm me-2">Edit</a>
                    <form method="POST" action="{{ url_for('activities_bp.delete_activity', activity_id=activity.id) }}" style="display: inline;">
                        <button class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No activities available.</p>
        {% endif %}
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">Create New Activity</div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('activities_bp.manage_activities') }}">
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="2" required></textarea>
            </div>
            <div class="mb-3">
                <label for="details" class="form-label">Details</label>
                <textarea class="form-control" id="details" name="details" rows="2"></textarea>
            </div>
            <div class="mb-3">
                <label for="user_profile_id" class="form-label">User Profile</label>
                <select class="form-control" id="userProfileSelect" name="user_profile_id" required>
                    {% for profile in user_profiles %}
                    <option value="{{ profile.id }}">{{ profile.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Create Activity</button>
        </form>
    </div>
</div>

<div class="mb-4">
    <button id="generateActivityButton" class="btn btn-info">Generate Activity</button>
    <div id="generateResponse" class="mt-3"></div>
</div>


{% endblock %}

{% block scripts %}
<script>
    document.getElementById('generateActivityButton').addEventListener('click', async () => {
        alert('Generating activities...is coming soon');
        return;
        const user_profile_id = document.getElementById('userProfileSelect').value;
        const response = await fetch('/activities/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                user_profile_id: user_profile_id
            }),
        });
        const result = await response.json();
        document.getElementById('generateResponse').textContent = result.message || result.error;
        setTimeout(() => {
            window.location.reload();
        }, 3000);
    });
</script>    
{% endblock %}